# Resumen de Funciones del Backend

Este documento detalla las funciones y endpoints encontrados en el proyecto actual, organizados por archivo.

##  [main.py](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py) (L贸gica Principal y Endpoints)

Este archivo contiene la inicializaci贸n de la aplicaci贸n FastAPI y la definici贸n de los endpoints.

### Autenticaci贸n y Utilidades

| Funci贸n | Descripci贸n | Par谩metros | Retorno |
| :--- | :--- | :--- | :--- |
| [verify_password](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#20-26) | Verifica si una contrase帽a en texto plano coincide con su hash. | `plain_password`, `hashed_password` | `bool` |
| [get_password_hash](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#27-29) | Genera un hash seguro para una contrase帽a. | [password](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#20-26) | `str` (hash) |
| [create_access_token](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#30-35) | Crea un token JWT de acceso. | `data` (dict) | `str` (token codificado) |
| [get_current_user](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#36-52) | Dependencia para obtener el usuario autenticado actual desde el token. | [token](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#30-35), [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23) | `models.User` |

### Endpoints (Rutas de la API)

#### General
- **`GET /`** ([read_root](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#65-68))
  - **Descripci贸n**: Endpoint de prueba para verificar que la API est谩 en l铆nea.
  - **Retorno**: Mensaje de bienvenida.

#### Servicios (`/services`)
- **`GET /services`** ([get_services](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#69-75))
  - **Descripci贸n**: Obtiene la lista de servicios del usuario autenticado.
  - **Par谩metros**: [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23), [current_user](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#36-52).
- **`POST /services`** ([create_service](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#76-89))
  - **Descripci贸n**: Crea un nuevo servicio para el usuario autenticado.
  - **Par谩metros**: `name`, `price`, `duration`, [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23), [current_user](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#36-52).
- **`DELETE /services/{service_id}`** ([delete_service](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#126-134))
  - **Descripci贸n**: Elimina un servicio espec铆fico por ID.
  - **Par谩metros**: `service_id`, [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).

#### Turnos (`/appointments`)
- **`GET /appointments`** ([get_appointments](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#90-97))
  - **Descripci贸n**: Lista los turnos, opcionalmente filtrados por estado ([status](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#115-125)), ordenados por fecha.
  - **Par谩metros**: [status](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#115-125) (opcional), [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).
- **`POST /appointments`** ([create_appointment](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#98-114))
  - **Descripci贸n**: Crea un nuevo turno.
  - **Par谩metros**: `customer_name`, `service_id`, `date_time`, [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).
- **`PATCH /appointments/{appointment_id}/status`** ([update_status](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#115-125))
  - **Descripci贸n**: Actualiza el estado de un turno (ej. confirmado, cancelado).
  - **Par谩metros**: `appointment_id`, [status](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#115-125), [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).

#### Horarios (`/schedule`)
- **`GET /schedule`** ([get_schedule](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#142-145))
  - **Descripci贸n**: Obtiene la configuraci贸n de horarios de atenci贸n.
  - **Par谩metros**: [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).
- **`POST /schedule`** ([update_schedule](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#146-160))
  - **Descripci贸n**: Actualiza (sobrescribe) los horarios de atenci贸n.
  - **Par谩metros**: `schedules` (lista de horarios), [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).

#### Perfil (`/profile`)
- **`GET /profile`** ([get_profile](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#168-177))
  - **Descripci贸n**: Obtiene el perfil de la barber铆a.
  - **Par谩metros**: [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).
- **`POST /profile`** ([update_profile](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#178-194))
  - **Descripci贸n**: Actualiza o crea el perfil de la barber铆a.
  - **Par谩metros**: `data` (ProfileSchema), [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).

#### Usuarios y Autenticaci贸n
- **`POST /register`** ([register_user](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#195-210))
  - **Descripci贸n**: Registra un nuevo usuario y crea un perfil por defecto.
  - **Par谩metros**: `form_data` (username, password), [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).
- **`POST /token`** ([login_for_access_token](file:///c:/Users/nicot/Documents/Backend/turnero-backend/main.py#211-238))
  - **Descripci贸n**: Endpoint para login. Valida credenciales y devuelve un token de acceso.
  - **Par谩metros**: `form_data`, [db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23).

---

##  [database.py](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py) (Base de Datos)

Maneja la conexi贸n y sesi贸n con la base de datos.

| Funci贸n | Descripci贸n |
| :--- | :--- |
| [get_db](file:///c:/Users/nicot/Documents/Backend/turnero-backend/database.py#17-23) | Generador (dependency) que crea una nueva sesi贸n de base de datos para cada request y la cierra al finalizar. |
| `engine` | Instancia del motor de base de datos SQLAlchemy. |
| `SessionLocal` | F谩brica de sesiones de base de datos. |

---

##  [models.py](file:///c:/Users/nicot/Documents/Backend/turnero-backend/models.py) (Modelos de Datos)

Define las tablas de la base de datos utilizando SQLAlchemy ORM.

- **[User](file:///c:/Users/nicot/Documents/Backend/turnero-backend/models.py#5-15)**: Usuarios del sistema (barberos/administradores).
- **[Profile](file:///c:/Users/nicot/Documents/Backend/turnero-backend/models.py#16-28)**: Informaci贸n p煤blica del perfil (nombre de la barber铆a, bio, etc.).
- **[Service](file:///c:/Users/nicot/Documents/Backend/turnero-backend/models.py#29-40)**: Servicios ofrecidos (corte, barba, etc.).
- **[Appointment](file:///c:/Users/nicot/Documents/Backend/turnero-backend/models.py#41-53)**: Turnos agendados.
- **[Schedule](file:///c:/Users/nicot/Documents/Backend/turnero-backend/models.py#54-65)**: Configuraci贸n de horarios de apertura y cierre.
